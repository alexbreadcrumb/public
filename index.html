<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleccionar Cámara</title>
</head>
<body>
    <h1>Selecciona la Cámara</h1>
    <select id="cameraSelect"></select>
    <br><br>
    <video id="video" autoplay playsinline width="640" height="480" style="border: 1px solid #ccc;"></video>

    <script>
        let currentStream;

        async function getCameras() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                const cameraSelect = document.getElementById('cameraSelect');

                videoDevices.forEach(device => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.textContent = device.label || `Cámara ${cameraSelect.length + 1}`;
                    cameraSelect.appendChild(option);
                });

                if (videoDevices.length === 0) {
                    alert('No se encontraron cámaras disponibles.');
                } else {
                    // Iniciar la cámara seleccionada por defecto
                    startCamera(videoDevices[0].deviceId);
                }
            } catch (error) {
                console.error('Error al obtener las cámaras:', error);
            }
        }

        async function startCamera(deviceId) {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            const stream = await navigator.mediaDevices.getUserMedia({
                video: { deviceId: { exact: deviceId } }
            });

            currentStream = stream;
            const videoElement = document.getElementById('video');
            videoElement.srcObject = stream;
        }

        // Cuando se cambia la selección de la cámara
        document.getElementById('cameraSelect').addEventListener('change', (event) => {
            startCamera(event.target.value);
        });

        // Solicitar permiso y obtener cámaras al cargar la página
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(() => getCameras())
            .catch(error => {
                console.error('Permiso denegado o error en el acceso a la cámara:', error);
                alert('Por favor, otorga permiso para usar la cámara.');
            });
    </script>
</body>
</html>
